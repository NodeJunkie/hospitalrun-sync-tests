(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app"],{0:function(e,t,n){e.exports=n("2f39")},1:function(e,t){},2:function(e,t){},"2f39":function(e,t,n){"use strict";n.r(t);var r=n("967e"),i=n.n(r),a=(n("96cf"),n("fa84")),s=n.n(a),o=(n("7d6e"),n("e54f"),n("62f2"),n("7e6d"),n("2b0e")),u=n("b178");o["a"].use(u["a"],{config:{}});var c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"q-app"}},[n("router-view")],1)},h=[],l={name:"App"},f=l,p=n("2877"),d=Object(p["a"])(f,c,h,!1,null,null,null),v=d.exports,g=n("8c4f"),m=[{path:"/",component:function(){return n.e("3e1accb8").then(n.bind(null,"a4b2"))},children:[{path:"",name:"auth",meta:{public:!0},component:function(){return n.e("2d0e8be2").then(n.bind(null,"8b24"))}},{path:"login",meta:{public:!0},component:function(){return n.e("2d0a314a").then(n.bind(null,"013f"))}},{path:"register",meta:{public:!0},component:function(){return n.e("2d0c8f69").then(n.bind(null,"56b4"))}},{path:"profile",meta:{auth:!0},component:function(){return n.e("2d0be6fd").then(n.bind(null,"2ff9"))}},{path:"admin",meta:{admin:!0},component:function(){return n.e("2d0ccfc5").then(n.bind(null,"4feb"))}}]}];m.push({path:"*",component:function(){return n.e("4b47640d").then(n.bind(null,"e51e"))}});var y=m;o["a"].use(g["a"]);var b=function(e){var t=new g["a"]({scrollBehavior:function(){return{x:0,y:0}},routes:y,mode:"hash",base:""});return t.beforeEach(function(e,t,n){console.log(e);var r=e.matched.some(function(e){return e.meta.public}),i=e.matched.some(function(e){return e.meta.auth}),a=!0;a&&i&&n(),r&&n()}),t},w=function(){var e="function"===typeof b?b({Vue:o["a"]}):b,t={el:"#q-app",router:e,render:function(e){return e(v)}};return{app:t,router:e}},k=n("16b2"),x=n("56ec"),z=n.n(x),D=n("5d16"),O=n("4833"),E=n.n(O),P=n("fcd3"),S=n("4317"),j=n.n(S),_=n("dc60"),I=(n("7f7f"),n("fc74")),U=n.n(I),K=n("59a1"),L=n.n(K),R=(n("8e6e"),n("8a81"),n("ac6a"),n("cadf"),n("456d"),n("28a5"),n("c47a")),B=n.n(R),C=(n("551c"),n("06db"),n("4917"),n("e813")),F=n.n(C);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(n,!0).forEach(function(t){B()(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var H=function(){function e(){U()(this,e),this.id=null,this.user=null,this.registrations={},this.keystore=null,this.catalog=null}return L()(e,[{key:"setKeyStore",value:function(e){var t=e.secret;if(!this.user||!this.user.name||!this.user.id)throw new Error("Musts have a Username to create a Keystore");if(!t)throw new Error("Cannot create Keystore without a KeystoreSecret");null===this.keystore&&(this.keystore=new k["a"]("".concat(this.user.id,"_keystore")),this.keystore.crypto(t))}},{key:"registerUserToDevice",value:function(e){var t=e.user,n=e.secret,r=e.databaseString;"undefined"===typeof this.registrations[t.organization]&&(this.registrations[t.organization]={}),"undefined"===typeof this.registrations[t.organization][this.id]&&(this.registrations[t.organization][this.id]={}),"undefined"===typeof this.registrations[t.organization][this.id][t.name]&&(this.registrations[t.organization][this.id][t.name]={}),r?(r.match("keystore")&&(this.registrations[t.organization][this.id][t.name].keystore=r),r.match("catalog")&&(this.registrations[t.organization][this.id][t.name].catalog=r)):(this.keystore&&this.keystore.name&&(this.registrations[t.organization][this.id][t.name].keystore=this.keystore.name),this.catalog&&this.catalog.name&&(this.registrations[t.organization][this.id][t.name].keystore=this.catalog.name)),"undefined"!==typeof t.id&&n&&(this.user=t,this.setKeyStore({secret:n}),this.lastLogin=t.name)}},{key:"canReadKeystore",value:function(){var e=s()(i.a.mark(function e(){var t=this;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=s()(i.a.mark(function e(n){var r,a;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=t.user,e.prev=1,e.next=4,t.keystore.get(a.id);case 4:r=e.sent,console.log("Doc exists",r),a=T({},a,{},r),n("undefined"===typeof r.meta),e.next=33;break;case 10:if(e.prev=10,e.t0=e["catch"](1),"not_found"!==e.t0.name){e.next=32;break}return console.log("Not found!"),e.prev=14,console.log(a.meta),e.next=18,t.keystore.put({_id:a.id,meta:a.meta});case 18:e.next=25;break;case 20:e.prev=20,e.t1=e["catch"](14),console.log(e.t1),console.log("!!!!!!!!!!!!!!!!!!!!!"),n(!1);case 25:return e.next=27,t.keystore.get(a.id);case 27:r=e.sent,a.meta=r.meta,a.rev=r._rev,console.log(a),"undefined"===typeof r.meta?n(!1):n(!0);case 32:n(!1);case 33:case"end":return e.stop()}},e,null,[[1,10],[14,20]])}));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()},{key:"init",value:function(){var e=s()(i.a.mark(function e(){var t,n,r,a=this;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getDeviceFingerprint();case 2:return t=e.sent,n=t.id,r=t.meta,this.id=n,this.meta=r,e.next=9,this.updateDBIndex();case 9:return this.databases.length>0&&this.databases.forEach(function(e){a.registerExistingDatabase(e)}),e.abrupt("return",this);case 11:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"registerExistingDatabase",value:function(e){var t=this.deserializeUserFromDatabaseString(e);this.registerUserToDevice({user:t,databaseString:e})}},{key:"deserializeUserFromDatabaseString",value:function(e){var t=e.split("_");return console.log(t),{organization:t[0],device:{id:t[1]},name:t[2]}}},{key:"getDeviceFingerprint",value:function(){var e=s()(i.a.mark(function e(){return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){var t={};F.a.get(function(n){var r=n.map(function(e){return t[e.key]=e.value,e.value});e({meta:t,id:F.a.x64hash128(r.join(""),31)})})}));case 1:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()},{key:"updateDBIndex",value:function(){var e=s()(i.a.mark(function e(){return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,k["a"].allDbs();case 2:this.databases=e.sent;case 3:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"lastLogin",set:function(e){console.log(e),localStorage.setItem("user",e||"")},get:function(){return localStorage.getItem("user")}}]),e}(),V=function(){function e(){U()(this,e),this.id=null,this.name=null,this.organization=null,this.device=null,this.meta={firstName:null,lastName:null}}return L()(e,[{key:"init",value:function(){var e=s()(i.a.mark(function e(){return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.device=new H,e.next=3,this.device.init();case 3:this.name=this.device.lastLogin?this.device.lastLogin:this.name;case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},{key:"generateId",value:function(){return"".concat(this.organization||"HostpitalRun","_").concat(this.device.id,"_").concat(this.name||"Public")}},{key:"logout",value:function(){this.id=void 0,this.name=void 0,this.rev=void 0,this.organization=void 0,this.device.lastLogin=void 0}},{key:"loginWithSecret",value:function(){var e=s()(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.organization||(this.organization="HospitalRun"),this.id=this.generateId(),e.next=4,this.device.updateDBIndex();case 4:if(-1!==this.device.databases.indexOf("".concat(this.id,"_keystore"))){e.next=10;break}throw n=new Error("Must be registered user"),n.name="NotRegistered",n;case 10:return this.device.registerUserToDevice({user:this,secret:t,type:"login"}),e.next=13,this.device.canReadKeystore({user:this});case 13:r=e.sent,console.log("Can Login?",r),r?this.device.lastLogin=this.name:(this.logout(),alert("Bad Password"));case 16:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()},{key:"register",value:function(){var e=s()(i.a.mark(function e(t){var n,r,a,s,o,u;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=t.name,r=t.secret,a=t.organization,s=void 0===a?"HospitalRun":a,this.name=n,this.organization=s,this.id=this.generateId(),e.next=6,this.device.updateDBIndex();case 6:if(-1===this.device.databases.indexOf("".concat(this.id,"_keystore"))){e.next=12;break}throw o=new Error("User exists!"),o.name="UserExists",o;case 12:return this.device.registerUserToDevice({user:this,secret:r}),e.next=15,this.device.canReadKeystore();case 15:if(u=e.sent,u){e.next=18;break}throw new Error("Cannot read from the keystore!");case 18:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()}]),e}();k["a"].plugin(n("5a14")),k["a"].plugin(z.a),k["a"].plugin(D["a"]),k["a"].plugin(E.a),k["a"].plugin(P["a"]),n("8dfe")(k["a"]);var q=function(){var e=s()(i.a.mark(function e(t){var n,r;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return n=t.Vue,r=new V({}),e.next=4,r.init();case 4:n.use(_["a"],{globals:{$user:r}}),n.use(j.a,{pouch:k["a"]});case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),J=w(),M=J.app,$=J.router;function A(){return Q.apply(this,arguments)}function Q(){return Q=s()(i.a.mark(function e(){var t,n;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:t=[q],n=0;case 2:if(!(n<t.length)){e.next=20;break}if("function"===typeof t[n]){e.next=5;break}return e.abrupt("continue",17);case 5:return e.prev=5,e.next=8,t[n]({app:M,router:$,Vue:o["a"],ssrContext:null});case 8:e.next=17;break;case 10:if(e.prev=10,e.t0=e["catch"](5),!e.t0||!e.t0.url){e.next=15;break}return window.location.href=e.t0.url,e.abrupt("return");case 15:return console.error("[Quasar] boot error:",e.t0),e.abrupt("return");case 17:n++,e.next=2;break;case 20:new o["a"](M);case 21:case"end":return e.stop()}},e,null,[[5,10]])})),Q.apply(this,arguments)}A()},3:function(e,t){},4:function(e,t){},5:function(e,t){},6:function(e,t){},"7e6d":function(e,t,n){}},[[0,"runtime","vendor"]]]);